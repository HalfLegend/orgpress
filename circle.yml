machine:
  environment:
    PATH: /usr/local/bin:$HOME/.cask/bin:$PATH
dependencies:
  cache_directories:
    - pandoc-1.13.2-1-amd64.deb
    - .cask
    - emacs-24.5
    - ~/.org-timestamps
  pre:
    - if [[ ! -e emacs-24.5 ]]; then wget http://gnu.opencube.ca/emacs/emacs-24.5.tar.xz && tar xf emacs-24.5.tar.xz && cd emacs-24.5 && ./configure && make && cd ..; fi
    - cd emacs-24.5 && sudo make install && cd ..
    - sudo rm /usr/bin/emacs && sudo ln -s /usr/local/bin/emacs /usr/bin/emacs
    - if [[ ! -e pandoc-1.13.2-1-amd64.deb ]]; then wget https://github.com/jgm/pandoc/releases/download/1.13.2/pandoc-1.13.2-1-amd64.deb;fi
    - sudo dpkg -i pandoc-1.13.2-1-amd64.deb && curl -fsSL https://raw.githubusercontent.com/cask/cask/master/go | python
    - cask install
test:
  pre:
    - ci/publish.sh
deployment:
  production:
    branch: master
    commands:
      - ci/push.sh